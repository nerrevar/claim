<!DOCTYPE html>
<html>
<head>
  <title>{{ title }}</title>
  <meta charset='utf-8' />
  <!-- <meta name='viewport' value='initial' /> -->
  <style>
    th,td {
      border: 1px solid black;
    }
  </style>
  {% block style %}
  {% endblock %}
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script>
    function set_start_date(){
      document.cookie = "start_date=" + $("#start_date").val()
      location.reload(true)
    }
    function set_end_date(){
      document.cookie = "end_date=" + $("#end_date").val()
      location.reload(true)
    }
  </script>
  <script>
    $(
      () =>{
        let cookies = {}
        let cookie_strings = document.cookie.split(';').map(cookie_string => {
          let cookie_arr = cookie_string.trim().split('=')
          cookies[cookie_arr[0]] = cookie_arr[1]
        })
        if (cookies['start_date'])
          $("#start_date").val(cookies['start_date'])
        else
          $("#start_date").val(date => {
            curr_date = new Date()
            date_str = '' + curr_date.getFullYear() + '-'
            if (curr_date.getMonth() < 9){
              month = curr_date.getMonth() + 1
              date_str += '0' + month
            }
            else
              date_str += curr_date.getMonth()
            date_str += '-01'
            return  date_str
          })
        if (cookies['end_date'])
          $("#end_date").val(cookies['end_date'])
        else
          $("#end_date").val(date => {
            curr_date = new Date()
            new_date = new Date(curr_date.getFullYear(), curr_date.getMonth() + 1, 0)
            date_str = '' + new_date.getFullYear() + '-'
            if (new_date.getMonth() < 9){
              month = new_date.getMonth() + 1
              date_str += '0' + month
            }
            else
              date_str += new_date.getMonth()
            date_str += '-' + new_date.getDate()
            return date_str
          })
      }
    )
  </script>
  {% block scripts %}
  {% endblock %}
</head>
<body>
  <header>
    <nav>
      <a href='/'>Статистика</a>
      {% if group == 'view' or group == 'work' %}
        <a href='stat_kv'>Статистика по КВ</a>
        <a href='stat_question'>Статистика по вопросам</a>
        {% if group == 'work' %}
          <a href='add_error'>Добавить ошибку</a>
        {% endif %}
      {% endif %}
      <a style='float:right' href='site_logout'>Выход</a>
    </nav>
  </header>
  <h1>{{ title }}</h1>
  {% if not not_show %}
    <div id="dates">
      <label for="start_date">Начальная дата</label>
      <input type="date" id="start_date" onchange="set_start_date()" />
      <label for="end_date">Конечная дата</label>
      <input type="date" id="end_date" onchange="set_end_date()" />
    </div>
  {% endif %}
  {% block main %}
  {% endblock main %}
</body>
</html>
